<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>工程预算管理系统</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  
  <!-- Tailwind 配置 -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#165DFF',
            secondary: '#36D399',
            warning: '#FFAB00',
            danger: '#F87272',
            neutral: '#3D4451',
            'neutral-content': '#F2F2F2',
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
        },
      }
    }
  </script>
  
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .card-shadow {
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
      }
      .table-hover-effect {
        transition: background-color 0.2s ease;
      }
      .table-hover-effect:hover {
        background-color: rgba(22, 93, 255, 0.05);
      }
      .fade-in {
        animation: fadeIn 0.3s ease-in-out;
      }
      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }
    }
  </style>
</head>
<body class="bg-gray-50 font-inter text-neutral min-h-screen flex flex-col">
  <!-- 顶部导航 -->
  <header class="bg-white shadow-sm sticky top-0 z-50">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <i class="fa fa-calculator text-primary text-2xl"></i>
        <h1 class="text-xl font-bold text-primary">工程预算管理系统</h1>
      </div>
      
      <nav class="hidden md:flex items-center space-x-6">
        <a href="#" class="text-primary font-medium flex items-center">
          <i class="fa fa-home mr-1"></i> 首页
        </a>
        <a href="#" class="text-neutral hover:text-primary transition-colors duration-200 flex items-center">
          <i class="fa fa-file-text-o mr-1"></i> 预算管理
        </a>
        <a href="#" class="text-neutral hover:text-primary transition-colors duration-200 flex items-center">
          <i class="fa fa-line-chart mr-1"></i> 统计分析
        </a>
        <a href="#" class="text-neutral hover:text-primary transition-colors duration-200 flex items-center">
          <i class="fa fa-cog mr-1"></i> 系统设置
        </a>
      </nav>
      
      <div class="flex items-center space-x-4">
        <div class="relative">
          <button class="flex items-center space-x-2 text-neutral hover:text-primary transition-colors duration-200">
            <img src="https://picsum.photos/id/1005/200/200" alt="用户头像" class="w-8 h-8 rounded-full object-cover border border-gray-200">
            <span class="hidden md:inline">预算员</span>
            <i class="fa fa-angle-down"></i>
          </button>
        </div>
        <button class="md:hidden text-neutral hover:text-primary transition-colors duration-200">
          <i class="fa fa-bars text-xl"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- 主要内容区 -->
  <main class="flex-grow container mx-auto px-4 py-6">
    <div class="flex flex-col md:flex-row gap-6">
      <!-- 侧边栏 -->
      <aside class="md:w-64 shrink-0 hidden md:block">
        <div class="bg-white rounded-lg shadow-sm p-4 h-fit sticky top-24">
          <div class="mb-6">
            <h3 class="text-lg font-semibold text-neutral mb-3 flex items-center">
              <i class="fa fa-list-ul text-primary mr-2"></i> 功能导航
            </h3>
            <ul class="space-y-1">
              <li>
                <a href="#" class="flex items-center px-3 py-2 text-sm font-medium rounded-md bg-primary/10 text-primary">
                  <i class="fa fa-plus-circle mr-2"></i> 新建预算
                </a>
              </li>
              <li>
                <a href="#" class="flex items-center px-3 py-2 text-sm font-medium rounded-md text-neutral hover:bg-gray-50 transition-colors duration-200">
                  <i class="fa fa-list-alt mr-2"></i> 预算列表
                </a>
              </li>
              <li>
                <a href="#" class="flex items-center px-3 py-2 text-sm font-medium rounded-md text-neutral hover:bg-gray-50 transition-colors duration-200">
                  <i class="fa fa-clock-o mr-2"></i> 待审批
                </a>
              </li>
              <li>
                <a href="#" class="flex items-center px-3 py-2 text-sm font-medium rounded-md text-neutral hover:bg-gray-50 transition-colors duration-200">
                  <i class="fa fa-check-circle mr-2"></i> 已审批
                </a>
              </li>
              <li>
                <a href="#" class="flex items-center px-3 py-2 text-sm font-medium rounded-md text-neutral hover:bg-gray-50 transition-colors duration-200">
                  <i class="fa fa-refresh mr-2"></i> 预算调整
                </a>
              </li>
            </ul>
          </div>
          
          <div>
            <h3 class="text-lg font-semibold text-neutral mb-3 flex items-center">
              <i class="fa fa-bar-chart text-primary mr-2"></i> 预算统计
            </h3>
            <div class="space-y-3">
              <div class="bg-gray-50 rounded p-3">
                <div class="flex justify-between text-sm mb-1">
                  <span class="text-neutral/70">本月预算总额</span>
                  <span class="font-medium">¥1,285,600</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="bg-primary h-2 rounded-full" style="width: 75%"></div>
                </div>
              </div>
              <div class="bg-gray-50 rounded p-3">
                <div class="flex justify-between text-sm mb-1">
                  <span class="text-neutral/70">已审批预算</span>
                  <span class="font-medium">¥962,300</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-2">
                  <div class="bg-secondary h-2 rounded-full" style="width: 65%"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </aside>
      
      <!-- 主内容 -->
      <div class="flex-grow">
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6 card-shadow">
          <div class="flex flex-col md:flex-row md:items-center justify-between mb-6">
            <div>
              <h2 class="text-2xl font-bold text-neutral mb-1">新建项目预算</h2>
              <p class="text-neutral/60 text-sm">请填写以下信息创建新项目预算</p>
            </div>
            <div class="mt-4 md:mt-0">
              <button class="bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-md transition-colors duration-200 flex items-center">
                <i class="fa fa-save mr-2"></i> 保存草稿
              </button>
            </div>
          </div>
          
          <!-- 预算表单 -->
          <form id="budgetForm">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
              <div>
                <label for="project_id" class="block text-sm font-medium text-neutral mb-1">项目名称 <span class="text-danger">*</span></label>
                <div class="relative">
                  <select id="project_id" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all duration-200 appearance-none">
                    <option value="">请选择项目</option>
                    <option value="1">商业大厦建设项目</option>
                    <option value="2">住宅小区改造工程</option>
                    <option value="3">市政道路扩建项目</option>
                    <option value="4">桥梁新建工程</option>
                  </select>
                  <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
                    <i class="fa fa-chevron-down text-gray-400"></i>
                  </div>
                </div>
              </div>
              
              <div>
                <label for="budget_code" class="block text-sm font-medium text-neutral mb-1">预算编号</label>
                <input type="text" id="budget_code" value="BG-20250605-001" readonly class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-md text-neutral/70">
              </div>
              
              <div>
                <label for="budget_date" class="block text-sm font-medium text-neutral mb-1">预算日期</label>
                <input type="date" id="budget_date" value="2025-06-05" class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all duration-200">
              </div>
              
              <div>
                <label for="budgeter" class="block text-sm font-medium text-neutral mb-1">预算编制人</label>
                <input type="text" id="budgeter" value="张三" readonly class="w-full px-4 py-2 bg-gray-50 border border-gray-300 rounded-md text-neutral/70">
              </div>
            </div>
            
            <div class="mb-6">
              <label class="block text-sm font-medium text-neutral mb-3">预算明细</label>
              <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                  <thead class="bg-gray-50">
                    <tr>
                      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral/70 uppercase tracking-wider">序号</th>
                      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral/70 uppercase tracking-wider">材料名称</th>
                      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral/70 uppercase tracking-wider">规格型号</th>
                      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral/70 uppercase tracking-wider">单位</th>
                      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral/70 uppercase tracking-wider">数量</th>
                      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral/70 uppercase tracking-wider">单价 (¥)</th>
                      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral/70 uppercase tracking-wider">金额 (¥)</th>
                      <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-neutral/70 uppercase tracking-wider">操作</th>
                    </tr>
                  </thead>
                  <tbody class="bg-white divide-y divide-gray-200" id="materialTableBody">
                    <!-- 动态添加的行 -->
                  </tbody>
                </table>
              </div>
              
              <div class="mt-4 flex justify-end">
                <button type="button" id="addMaterialRow" class="bg-gray-100 hover:bg-gray-200 text-neutral px-4 py-2 rounded-md transition-colors duration-200 flex items-center">
                  <i class="fa fa-plus mr-2"></i> 添加材料
                </button>
              </div>
            </div>
            
            <div class="flex justify-end space-x-3">
              <button type="button" class="px-6 py-2 border border-gray-300 rounded-md text-neutral hover:bg-gray-50 transition-colors duration-200">
                取消
              </button>
              <button type="submit" class="px-6 py-2 bg-primary hover:bg-primary/90 text-white rounded-md transition-colors duration-200 flex items-center">
                <i class="fa fa-check mr-2"></i> 提交预算
              </button>
            </div>
          </form>
        </div>
        
        <!-- 预算概览卡片 -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
          <div class="bg-white rounded-lg shadow-sm p-6 card-shadow">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-neutral font-medium">预算总额</h3>
              <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center">
                <i class="fa fa-calculator text-primary"></i>
              </div>
            </div>
            <div class="text-3xl font-bold text-neutral mb-1" id="totalAmount">¥0.00</div>
            <div class="text-xs text-neutral/60">包含材料、人工、设备等费用</div>
          </div>
          
          <div class="bg-white rounded-lg shadow-sm p-6 card-shadow">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-neutral font-medium">材料费用</h3>
              <div class="w-10 h-10 rounded-full bg-secondary/10 flex items-center justify-center">
                <i class="fa fa-cubes text-secondary"></i>
              </div>
            </div>
            <div class="text-3xl font-bold text-neutral mb-1" id="materialAmount">¥0.00</div>
            <div class="text-xs text-neutral/60">占比 <span id="materialPercent">0%</span></div>
          </div>
          
          <div class="bg-white rounded-lg shadow-sm p-6 card-shadow">
            <div class="flex items-center justify-between mb-4">
              <h3 class="text-neutral font-medium">审批状态</h3>
              <div class="w-10 h-10 rounded-full bg-warning/10 flex items-center justify-center">
                <i class="fa fa-hourglass-half text-warning"></i>
              </div>
            </div>
            <div class="text-3xl font-bold text-warning mb-1">待提交</div>
            <div class="text-xs text-neutral/60">提交后将进入审批流程</div>
          </div>
        </div>
        
        <!-- 图表分析 -->
        <div class="bg-white rounded-lg shadow-sm p-6 card-shadow">
          <h3 class="text-lg font-semibold text-neutral mb-4">预算构成分析</h3>
          <div class="h-64">
            <canvas id="budgetChart"></canvas>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-white border-t border-gray-200 py-6 mt-10">
    <div class="container mx-auto px-4">
      <div class="flex flex-col md:flex-row justify-between items-center">
        <div class="mb-4 md:mb-0">
          <p class="text-neutral/60 text-sm">&copy; 2025 工程预算管理系统. 保留所有权利.</p>
        </div>
        <div class="flex space-x-6">
          <a href="#" class="text-neutral/60 hover:text-primary transition-colors duration-200">
            <i class="fa fa-question-circle mr-1"></i> 帮助中心
          </a>
          <a href="#" class="text-neutral/60 hover:text-primary transition-colors duration-200">
            <i class="fa fa-file-text-o mr-1"></i> 使用文档
          </a>
          <a href="#" class="text-neutral/60 hover:text-primary transition-colors duration-200">
            <i class="fa fa-phone mr-1"></i> 联系我们
          </a>
        </div>
      </div>
    </div>
  </footer>

  <!-- 材料选择模态框 -->
  <div id="materialModal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden fade-in">
    <div class="bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[80vh] overflow-hidden flex flex-col">
      <div class="p-6 border-b border-gray-200 flex justify-between items-center">
        <h3 class="text-lg font-semibold text-neutral">选择材料</h3>
        <button id="closeModal" class="text-neutral/50 hover:text-neutral transition-colors duration-200">
          <i class="fa fa-times text-xl"></i>
        </button>
      </div>
      
      <div class="p-6 flex-grow overflow-y-auto">
        <div class="mb-4">
          <div class="relative">
            <input type="text" placeholder="搜索材料..." class="w-full px-4 py-2 pl-10 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all duration-200">
            <div class="absolute inset-y-0 left-0 flex items-center pl-3 pointer-events-none">
              <i class="fa fa-search text-gray-400"></i>
            </div>
          </div>
        </div>
        
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div class="border border-gray-200 rounded-md p-3 hover:border-primary hover:bg-primary/5 cursor-pointer transition-all duration-200">
            <div class="flex justify-between">
              <h4 class="font-medium text-neutral">水泥</h4>
              <span class="text-xs bg-gray-100 px-2 py-1 rounded">建筑材料</span>
            </div>
            <p class="text-sm text-neutral/70 mt-1">普通硅酸盐水泥 42.5级</p>
            <div class="flex justify-between mt-2">
              <span class="text-sm font-medium">¥450/吨</span>
              <button class="text-xs bg-primary/10 text-primary px-2 py-1 rounded">选择</button>
            </div>
          </div>
          
          <div class="border border-gray-200 rounded-md p-3 hover:border-primary hover:bg-primary/5 cursor-pointer transition-all duration-200">
            <div class="flex justify-between">
              <h4 class="font-medium text-neutral">钢筋</h4>
              <span class="text-xs bg-gray-100 px-2 py-1 rounded">建筑材料</span>
            </div>
            <p class="text-sm text-neutral/70 mt-1">HRB400E φ12mm</p>
            <div class="flex justify-between mt-2">
              <span class="text-sm font-medium">¥5,200/吨</span>
              <button class="text-xs bg-primary/10 text-primary px-2 py-1 rounded">选择</button>
            </div>
          </div>
          
          <div class="border border-gray-200 rounded-md p-3 hover:border-primary hover:bg-primary/5 cursor-pointer transition-all duration-200">
            <div class="flex justify-between">
              <h4 class="font-medium text-neutral">混凝土</h4>
              <span class="text-xs bg-gray-100 px-2 py-1 rounded">建筑材料</span>
            </div>
            <p class="text-sm text-neutral/70 mt-1">C30商品混凝土</p>
            <div class="flex justify-between mt-2">
              <span class="text-sm font-medium">¥480/立方米</span>
              <button class="text-xs bg-primary/10 text-primary px-2 py-1 rounded">选择</button>
            </div>
          </div>
          
          <div class="border border-gray-200 rounded-md p-3 hover:border-primary hover:bg-primary/5 cursor-pointer transition-all duration-200">
            <div class="flex justify-between">
              <h4 class="font-medium text-neutral">红砖</h4>
              <span class="text-xs bg-gray-100 px-2 py-1 rounded">建筑材料</span>
            </div>
            <p class="text-sm text-neutral/70 mt-1">标准黏土砖 240×115×53mm</p>
            <div class="flex justify-between mt-2">
              <span class="text-sm font-medium">¥0.5/块</span>
              <button class="text-xs bg-primary/10 text-primary px-2 py-1 rounded">选择</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="p-6 border-t border-gray-200 flex justify-end">
        <button class="px-4 py-2 border border-gray-300 rounded-md text-neutral hover:bg-gray-50 transition-colors duration-200 mr-3">
          取消
        </button>
        <button class="px-4 py-2 bg-primary hover:bg-primary/90 text-white rounded-md transition-colors duration-200">
          确认选择
        </button>
      </div>
    </div>
  </div>

  <!-- JavaScript -->
  <script>
    // 初始化图表
    const ctx = document.getElementById('budgetChart').getContext('2d');
    const budgetChart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['材料费用', '人工费用', '设备租赁', '其他费用'],
        datasets: [{
          data: [0, 0, 0, 0],
          backgroundColor: [
            '#165DFF',
            '#36D399',
            '#FFAB00',
            '#9333EA'
          ],
          borderWidth: 0,
          hoverOffset: 4
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'right',
          }
        },
        cutout: '70%'
      }
    });

    // 初始化材料行计数器
    let rowCount = 0;
    
    // 添加材料行
    document.getElementById('addMaterialRow').addEventListener('click', function() {
      rowCount++;
      
      const tableBody = document.getElementById('materialTableBody');
      const newRow = document.createElement('tr');
      newRow.className = 'table-hover-effect';
      newRow.innerHTML = `
        <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral">
          ${rowCount}
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <div class="relative">
            <input type="text" placeholder="选择材料" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all duration-200 cursor-pointer bg-gray-50" readonly onclick="openMaterialModal()">
            <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none">
              <i class="fa fa-chevron-down text-gray-400"></i>
            </div>
          </div>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="text" placeholder="规格型号" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all duration-200">
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <select class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all duration-200">
            <option value="吨">吨</option>
            <option value="立方米">立方米</option>
            <option value="平方米">平方米</option>
            <option value="块">块</option>
            <option value="米">米</option>
            <option value="个">个</option>
          </select>
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="number" min="0" step="0.01" placeholder="数量" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all duration-200 quantity-input" oninput="calculateAmount(this)">
        </td>
        <td class="px-6 py-4 whitespace-nowrap">
          <input type="number" min="0" step="0.01" placeholder="单价" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-primary/50 focus:border-primary outline-none transition-all duration-200 price-input" oninput="calculateAmount(this)">
        </td>
        <td class="px-6 py-4 whitespace-nowrap font-medium text-primary amount-cell">
          ¥0.00
        </td>
        <td class="px-6 py-4 whitespace-nowrap text-sm text-neutral">
          <button onclick="removeRow(this)" class="text-danger hover:text-danger/80 transition-colors duration-200">
            <i class="fa fa-trash"></i>
          </button>
        </td>
      `;
      
      tableBody.appendChild(newRow);
      updateChart();
    });
    
    // 计算金额
    function calculateAmount(input) {
      const row = input.closest('tr');
      const quantity = parseFloat(row.querySelector('.quantity-input').value) || 0;
      const price = parseFloat(row.querySelector('.price-input').value) || 0;
      const amount = quantity * price;
      
      row.querySelector('.amount-cell').textContent = `¥${amount.toFixed(2)}`;
      updateTotal();
      updateChart();
    }
    
    // 更新总计
    function updateTotal() {
      const amountCells = document.querySelectorAll('.amount-cell');
      let total = 0;
      
      amountCells.forEach(cell => {
        const amount = parseFloat(cell.textContent.replace('¥', '')) || 0;
        total += amount;
      });
      
      document.getElementById('totalAmount').textContent = `¥${total.toFixed(2)}`;
      document.getElementById('materialAmount').textContent = `¥${total.toFixed(2)}`;
      document.getElementById('materialPercent').textContent = total > 0 ? '100%' : '0%';
    }
    
    // 更新图表
    function updateChart() {
      const amountCells = document.querySelectorAll('.amount-cell');
      let total = 0;
      
      amountCells.forEach(cell => {
        const amount = parseFloat(cell.textContent.replace('¥', '')) || 0;
        total += amount;
      });
      
      // 更新图表数据（示例数据，实际应根据业务逻辑更新）
      budgetChart.data.datasets[0].data = [
        total,  // 材料费用
        0,      // 人工费用
        0,      // 设备租赁
        0       // 其他费用
      ];
      
      budgetChart.update();
    }
    
    // 移除行
    function removeRow(button) {
      const row = button.closest('tr');
      row.classList.add('fade-out');
      
      setTimeout(() => {
        row.remove();
        updateTotal();
        updateChart();
        renumberRows();
      }, 300);
    }
    
    // 重新编号
    function renumberRows() {
      const rows = document.querySelectorAll('#materialTableBody tr');
      rows.forEach((row, index) => {
        row.querySelector('td:first-child').textContent = index + 1;
      });
      rowCount = rows.length;
    }
    
    // 打开材料选择模态框
    function openMaterialModal() {
      document.getElementById('materialModal').classList.remove('hidden');
    }
    
    // 关闭材料选择模态框
    document.getElementById('closeModal').addEventListener('click', function() {
      document.getElementById('materialModal').classList.add('hidden');
    });
    
    // 点击模态框外部关闭
    document.getElementById('materialModal').addEventListener('click', function(e) {
      if (e.target === this) {
        this.classList.add('hidden');
      }
    });
    
    // 表单提交
    document.getElementById('budgetForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      // 收集表单数据
      const formData = {
        project_id: document.getElementById('project_id').value,
        budget_code: document.getElementById('budget_code').value,
        budget_date: document.getElementById('budget_date').value,
        details: []
      };
      
      const rows = document.querySelectorAll('#materialTableBody tr');
      rows.forEach(row => {
        const materialName = row.querySelector('td:nth-child(2) input').value;
        const specification = row.querySelector('td:nth-child(3) input').value;
        const unit = row.querySelector('td:nth-child(4) select').value;
        const quantity = parseFloat(row.querySelector('.quantity-input').value) || 0;
        const price = parseFloat(row.querySelector('.price-input').value) || 0;
        
        if (materialName && quantity > 0 && price > 0) {
          formData.details.push({
            material_name: materialName,
            specification: specification,
            unit: unit,
            quantity: quantity,
            unit_price: price
          });
        }
      });
      
      // 简单验证
      if (!formData.project_id) {
        alert('请选择项目');
        return;
      }
      
      if (formData.details.length === 0) {
        alert('请添加至少一项材料');
        return;
      }
      
      // 模拟提交
      console.log('提交预算数据:', formData);
      
      // 显示成功提示
      alert('预算已提交，等待审批');
    });
    
    // 初始化添加一行
    document.getElementById('addMaterialRow').click();
  </script>
</body>
</html>
    